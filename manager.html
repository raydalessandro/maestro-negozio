<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Manager - Maestro di Negozio</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>👨‍💼 Dashboard Manager</h1>
            <p class="subtitle">Sistema di Monitoraggio Task</p>
        </div>

        <div class="back-button">
            <button class="btn btn-secondary" onclick="goHome()">← Indietro</button>
            <button class="btn btn-secondary" onclick="logout()" style="margin-left: 10px;">🚪 Logout</button>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('tasks')">📋 Gestione Task</div>
            <div class="tab" onclick="switchTab('analytics')">📊 Analytics</div>
            <div class="tab" onclick="switchTab('leaderboard')">🏆 Classifica</div>
            <div class="tab" onclick="switchTab('history')">📂 Storico</div>
            <div class="tab" onclick="switchTab('feedbacks')">💬 Feedback Team</div>
        </div>

        <!-- TAB GESTIONE TASK -->
        <div id="tab-tasks" class="tab-content active">
            <div class="month-controls">
                <button class="btn btn-secondary" onclick="previousMonth()">◀</button>
                <div class="month-display" id="currentMonth"></div>
                <button class="btn btn-secondary" onclick="nextMonth()">▶</button>
            </div>

            <div class="card">
                <h2>📋 Seleziona Persona</h2>
                <div class="person-selector">
                    <button class="person-btn" onclick="selectPerson('Gemy')">Gemy</button>
                    <button class="person-btn" onclick="selectPerson('Valeria')">Valeria</button>
                    <button class="person-btn" onclick="selectPerson('Riky')">Riky</button>
                </div>

                <div class="date-selector">
                    <label>📅 Data: </label>
                    <input type="date" id="taskDate" onchange="loadTasksForDate()">
                </div>
            </div>

            <div id="tasksList"></div>

            <div class="card">
                <div class="penalty-summary" id="penaltySummary">
                    <h3>📊 Riepilogo Penalità</h3>
                    <p>Seleziona le task non completate per vedere il totale</p>
                </div>
            </div>

            <div class="card action-buttons">
                <button class="btn btn-primary" onclick="saveTasksForToday()">💾 Salva Penalità</button>
                <button class="btn btn-secondary" onclick="clearSelection()">🔄 Resetta Selezione</button>
            </div>
        </div>

        <!-- TAB ANALYTICS -->
        <div id="tab-analytics" class="tab-content">
            <!-- Team Health Score -->
            <div class="card analytics-hero">
                <h2>🏥 Team Health Score</h2>
                <div id="teamHealthScore"></div>
            </div>

            <!-- Insights AI -->
            <div class="card">
                <h2>🤖 AI Insights</h2>
                <p style="opacity: 0.8; margin-bottom: 20px;">Analisi automatica basata sui dati raccolti</p>
                <div id="aiInsights"></div>
            </div>

             <div id="feedbackInsights"></div>
            
            <!-- Grafici -->
            <div class="analytics-grid">
                <!-- Trend Punti -->
                <div class="card">
                    <h3>📈 Trend Punti (ultimi 30 giorni)</h3>
                    <canvas id="trendChart" style="height: 300px;"></canvas>
                </div>

                <!-- Heatmap Task -->
                <div class="card">
                    <h3>🔥 Task Più Problematiche</h3>
                    <canvas id="heatmapChart" style="height: 300px;"></canvas>
                </div>

                <!-- Pattern Giornalieri -->
                <div class="card">
                    <h3>📅 Errori per Giorno Settimana</h3>
                    <canvas id="weekdayChart" style="height: 300px;"></canvas>
                </div>

                <!-- Comparazione Settimanale -->
                <div class="card">
                    <h3>⚖️ Questa Settimana vs Settimana Scorsa</h3>
                    <canvas id="comparisonChart" style="height: 300px;"></canvas>
                </div>
            </div>

            <!-- Previsioni -->
            <div class="card">
                <h2>🔮 Previsioni Fine Mese</h2>
                <div id="predictions"></div>
            </div>

            <!-- Raccomandazioni Personalizzate -->
            <div class="card">
                <h2>💡 Raccomandazioni per Persona</h2>
                <div class="person-selector">
                    <button class="person-btn" onclick="showRecommendations('Gemy')">Gemy</button>
                    <button class="person-btn" onclick="showRecommendations('Valeria')">Valeria</button>
                    <button class="person-btn" onclick="showRecommendations('Riky')">Riky</button>
                </div>
                <div id="recommendations"></div>
            </div>

            <!-- Correlazioni -->
            <div class="card">
                <h2>🔗 Task Correlate</h2>
                <p style="opacity: 0.8; margin-bottom: 20px;">Task che vengono spesso saltate insieme</p>
                <div id="correlations"></div>
            </div>
        </div>

        <!-- TAB CLASSIFICA -->
        <div id="tab-leaderboard" class="tab-content">
            <div class="card">
                <h2>🏆 Classifica Attuale</h2>
                <div id="leaderboard" class="leaderboard"></div>
            </div>
        </div>

        <!-- TAB STORICO -->
        <div id="tab-history" class="tab-content">
            <div class="card">
                <h2>📊 Storico e Report</h2>
                <div class="history-controls">
                    <select id="historyPerson" onchange="loadHistory()">
                        <option value="all">Tutti</option>
                        <option value="Gemy">Gemy</option>
                        <option value="Valeria">Valeria</option>
                        <option value="Riky">Riky</option>
                    </select>
                    <input type="date" id="historyFromDate" onchange="loadHistory()">
                    <span>→</span>
                    <input type="date" id="historyToDate" onchange="loadHistory()">
                    <button class="btn btn-primary" onclick="loadHistory()">🔍 Filtra</button>
                </div>
                <div id="historyList"></div>
            </div>

            <div class="card">
                <h3>📄 Report e Gestione</h3>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="generateWeeklyReport()">📄 Report Settimanale (PDF)</button>
                    <button class="btn btn-primary" onclick="generateMonthlyReport()">📊 Report Mensile (PDF)</button>
                </div>
            </div>

            <div class="card">
                <h3>💾 Backup Dati</h3>
                <p style="margin-bottom: 15px; opacity: 0.8; font-size: 0.95em;">
                    💡 Scarica backup periodici per conservare lo storico anche a fine anno.
                </p>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="downloadBackup()">💾 Scarica Backup</button>
                    <button class="btn btn-secondary" onclick="uploadBackup()">📥 Carica Backup</button>
                    <button class="btn btn-secondary" onclick="resetMonth()">🔄 Reset Mese</button>
                </div>
                <p style="margin-top: 15px; opacity: 0.7; font-size: 0.9em;">
                    ⚠️ Consiglio: Scarica backup ogni fine mese!
                </p>
            </div>
        </div>
    </div>

    <!-- TAB FEEDBACK TEAM -->
        <div id="tab-feedbacks" class="tab-content">
            <div class="card">
                <h2>💬 Feedback Anonimi del Team</h2>
                <p style="opacity: 0.8; margin-bottom: 20px;">
                    Messaggi anonimi inviati dal team per migliorare l'ambiente di lavoro
                </p>
                
                <!-- Statistiche Mood -->
                <div style="margin-bottom: 30px;">
                    <h3>📊 Umore del Team</h3>
                    <div id="feedbackMoodStats" style="margin-top: 15px;">
                        <!-- Popolato da JS -->
                    </div>
                </div>
                
                <!-- Lista Feedback -->
                <div style="margin-top: 30px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3>💬 Ultimi 50 Feedback</h3>
                        <button class="btn btn-secondary" onclick="loadManagerFeedbacks()">
                            🔄 Ricarica
                        </button>
                    </div>
                    <div id="feedbackListManager" style="max-height: 600px; overflow-y: auto; background: rgba(255,255,255,0.05); border-radius: 10px; padding: 15px;">
                        <p style="text-align: center; opacity: 0.6;">Caricamento...</p>
                    </div>
                </div>
            </div>
        </div>

    <!-- Script nell'ordine corretto -->
    <script src="assets/js/config.js"></script>
    <script src="assets/js/supabase-storage.js"></script>
    <script src="assets/js/data.js"></script>
    <script src="assets/js/ui.js"></script>
    <script src="assets/js/analytics.js"></script>
    <script src="assets/js/report.js"></script>
    <script src="assets/js/feedback.js"></script>
    <script src="assets/js/manager.js"></script>
</body>
</html>
